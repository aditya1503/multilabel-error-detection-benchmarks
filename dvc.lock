schema: '2.0'
stages:
  make_dataset:
    cmd: python src/data/make_dataset.py
    deps:
    - path: src/data/make_dataset.py
      md5: 1949ec9e6a5e6c1da1d20c57bc16abd2
      size: 11031
    params:
      params.yaml:
        dataset_kwargs:
          small:
            n_samples: 6000
            n_features: 3
            n_classes: 4
            n_labels: 2
            length: 500
            allow_unlabeled: true
            sparse: false
            test_size: 1000
            avg_trace: 0.925
            gamma:
              shape: 2.0
              scale: 0.01
          large:
            n_samples: 37500
            n_features: 20
            n_classes: 50
            n_labels: 5
            length: 500
            allow_unlabeled: true
            sparse: false
            test_size: 7500
            avg_trace: 0.995
            gamma:
              shape: 2.0
              scale: 0.01
        seeds:
        - 0
        - 1
        - 2
        - 3
        - 4
        - 5
        - 6
        - 7
        - 8
        - 9
    outs:
    - path: data/generated
      md5: 3a44a541a0b9437d6e18334f6abc8db2.dir
      size: 371398436
      nfiles: 20
  train:
    cmd: python src/models/train.py
    deps:
    - path: data/generated/
      md5: 3a44a541a0b9437d6e18334f6abc8db2.dir
      size: 371398436
      nfiles: 20
    - path: models/clf_dict.pkl
      md5: 46a9c1acf147e46f88291d8cc840ac12
      size: 997
    - path: models/cross_validator.pkl
      md5: 74bcfcac5b426c9204efa15edc85f691
      size: 114
    - path: src/models/train.py
      md5: b9a7897ed7bb31f2cf9d2f6181762f19
      size: 2490
    outs:
    - path: data/pred_probs/
      md5: 517a874bad8def2607eb8cdaad288169.dir
      size: 243204520
      nfiles: 20
  plot_avg_trace:
    cmd: python src/data/plot_avg_trace.py
    deps:
    - path: src/data/plot_avg_trace.py
      md5: 28ecfb27a7ba4e691e5e98753acf7562
      size: 1659
    params:
      params.yaml:
        dataset_kwargs.small.gamma:
          shape: 2.0
          scale: 0.01
    outs:
    - path: data/images/avg_trace.svg
      md5: 321e24781d590febed9c294668b7775e
      size: 25806
  get_avg_accuracy:
    cmd: python src/models/avg_accuracy.py
    deps:
    - path: data/generated
      md5: 3a44a541a0b9437d6e18334f6abc8db2.dir
      size: 371398436
      nfiles: 20
    - path: src/models/avg_accuracy.py
      md5: 44d66dd5af35ba2c62d79e9c9a3a6048
      size: 5472
    outs:
    - path: data/accuracy/results.csv
      md5: ff5d7521e7fcaab144468fa46f3773cd
      size: 18703
  group_stats:
    cmd: python src/models/group_stats.py
    deps:
    - path: data/accuracy/results.csv
      md5: ff5d7521e7fcaab144468fa46f3773cd
      size: 18703
    - path: src/models/group_stats.py
      md5: a41bc38c3179cfd5a3104ee5bace5293
      size: 3349
    outs:
    - path: data/accuracy/results_group.csv
      md5: e699f732148816ca2cd18d880ff87402
      size: 1177
    - path: data/accuracy/results_group.tex
      md5: 1b9e0811fdbac5173bd573c1e48c379b
      size: 1809
  score_classes:
    cmd: python src/evaluation/class_score.py
    deps:
    - path: data/pred_probs/
      md5: 517a874bad8def2607eb8cdaad288169.dir
      size: 243204520
      nfiles: 20
    - path: src/evaluation/class_score.py
      md5: c14257a9297816d1ab4596550dd76328
      size: 2115
    outs:
    - path: data/scores/class_scores.pkl
      md5: bf9d1dc371e3023bb333a4193c76cdc9
      size: 243202989
  aggregate:
    cmd: python src/evaluation/score.py
    deps:
    - path: data/scores/class_scores.pkl
      md5: bf9d1dc371e3023bb333a4193c76cdc9
      size: 243202989
    - path: src/evaluation/aggregate.py
      md5: e5e4152ed54ecb52044971db5c14a325
      size: 4866
    - path: src/evaluation/score.py
      md5: 68e37e7a3722b57cefd8a9c974d736ba
      size: 8329
    params:
      params.yaml:
        eval:
          ks:
          - 1
          - 2
          - 3
          - 4
          - 5
          - 10
          - 20
          - 50
          - 100
          temperatures:
          - 0.01
          - 0.1
          - 1
          - 10
          - 100
          alphas:
          - 0.2
          - 0.4
          - 0.5
          - 0.6
          - 0.8
          - 0.85
          - 0.9
          - 0.95
    outs:
    - path: data/scores/scores.pkl
      md5: 947cffb97ab55bfd7846b388618225c7
      size: 201235788
  rank_metrics:
    cmd: python src/evaluation/eval_ranking_metrics.py
    deps:
    - path: data/scores/scores.pkl
      md5: 947cffb97ab55bfd7846b388618225c7
      size: 201235788
    - path: src/evaluation/eval_ranking_metrics.py
      md5: e2762d8558021bf3ba6d3b40eac4158f
      size: 2917
    outs:
    - path: data/scores/results.csv
      md5: bbf2f9289212408eed865ff6ecfc32f5
      size: 578090
  plot_metrics:
    cmd: python src/evaluation/plot_metrics.py
    deps:
    - path: data/scores/results.csv
      md5: bbf2f9289212408eed865ff6ecfc32f5
      size: 578090
    - path: src/evaluation/plot_metrics.py
      md5: 8be1e636b365caabdf55ba927232a005
      size: 10095
    outs:
    - path: data/images/scores/
      md5: 36d731319e460253b81f8444e087759f.dir
      size: 417895
      nfiles: 20
    - path: data/scores/metrics.csv
      md5: 57840cf45a1d81004e742d3e2bd261e4
      size: 15657
  configure_train:
    cmd: python src/models/configure_train.py
    deps:
    - path: src/models/configure_train.py
      md5: 5f763abbfcee2a6263357473e6ff05c0
      size: 1950
    params:
      params.yaml:
        train:
          cv_n_folds: 5
          seed: 0
          clf_dict: models/clf_dict.pkl
          cross_validator: models/cross_validator.pkl
    outs:
    - path: models/clf_dict.pkl
      md5: 46a9c1acf147e46f88291d8cc840ac12
      size: 997
    - path: models/cross_validator.pkl
      md5: 74bcfcac5b426c9204efa15edc85f691
      size: 114
